<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Sensores Sistema Domótico</title>
	</head>
	<body>
		<form action="javascript:void(0);" onsubmit="javascript:enviar();">
			Valor a simular: <input type="label" id="val1" /><br />
			Sensor a simular:
			<select id="sensores">
				<option value="temperatura">Temperatura</option>
				<option value="luminosidad">Luminosidad</option>
			</select><br />
			<input type="submit" value="Simular" />
		</form>
		<span id="actuadores"></span>
		<a href="usuario.html">Página usuario</a>
		<span id="resul"></span>
		<div id="container-register">
			<h4>Registro</h4>
			<div id="resultados"></div>
		</div>
		<div id="container-user">
			<h4>Usuarios activos</h4>
			<span id="usuarios"></span>
		</div>
		<style type="text/css">
			#container-user{
				width: 50%;
				display: inline-block;
				position: absolute;
				margin-left: 50%
			}
			#container-register{
				width: 50%;
				position: absolute;
				display: inline-block;
			}
		</style>
	</body>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">
		var serviceURL = document.URL;
		var socket = io.connect('http://localhost:8080');

		function enviar() {
			var val1 = document.getElementById("val1").value;
			var sensor = document.getElementById("sensores").value;
			socket.emit('valores-captados',{sensor: sensor, valor : val1});
		}
		socket.on('usuarios-activos',function(data){
			actualizarLista(data,'usuarios');
		})
				
		socket.on('my-address', function(data) {
			var d = new Date();
			socket.emit('obtener-registro',{sensor: 'temperatura'});	
		});

		
		socket.on('obtener-registro',function(data){
			actualizarLista(data,'resultados');
		});

		socket.on('valoresSensores',function(valores){
            render(valores);
        });

        function render(valores)
        {
            var p = '<p> Temperatura (ºC)  '+valores.temperatura+'\nLuminosidad (%) '+ valores.luminosidad+' Persiana : '+valores.estadoPersiana+' Estado Aire Acondicionado '+valores.estadoAireAcondicionado+' Estado del agente domótico : '+valores.estadoAgenteDomotico+'<p>';
                
            document.getElementById('actuadores').innerHTML = p;
        }

		function actualizarLista(valores,identificador){
			var listContainer = document.getElementById(identificador);
			listContainer.innerHTML = '';
			var listElement = document.createElement('ul');
			listContainer.appendChild(listElement);
			var num = valores.length;
			for(var i=0; i<num; i++) {
	            var listItem = document.createElement('li');
	            listItem.innerHTML = JSON.stringify(valores[i]);
	            listElement.appendChild(listItem);
			}
	    }

	</script>
</html>
